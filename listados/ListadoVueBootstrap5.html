<!DOCTYPE html>
<html lang="es-ar">
<head>
  <meta charset="UTF-8">
  <title>Planillas por Carpeta - Bootstrap</title>
  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-4">

<div id="app" class="container">
  <h1 class="mb-4 fw-bold">Planillas</h1>
  
  <div v-for="(grupo, index) in planillasAgrupadas" :key="index" class="mb-3 card">
    <div class="card-header p-0">
      <button 
        @click="toggleGrupo(index)" 
        class="btn btn-primary w-100 text-start"
      >
        {{ grupo.carpeta }}
      </button>
    </div>
    <div v-show="grupo.abierto" class="card-body">
      <a 
        v-for="planilla in grupo.planillas" 
        :key="planilla.id"
        :href="'https://docs.google.com/spreadsheets/d/' + planilla.id"
        target="_blank"
        class="d-block mb-2 p-2 bg-light rounded text-decoration-none text-dark border"
      >
        ðŸ“„ {{ planilla.nombre }}
      </a>
    </div>
  </div>
</div>

<script>
const app = Vue.createApp({
  data() {
    return { planillasAgrupadas: [] }
  },
  methods: {
    async cargarDatos() {
      const respuesta = await fetch('https://script.google.com/macros/s/AKfycbzMN6x8dZJXe6CaCje2qZDgQcbjVhtflL-xA6HOqTwqlft746J3TF7FGUt37ttFmhTVSA/exec');
      const datos = await respuesta.json();
      if (!Array.isArray(datos) || datos.length === 0) return;
      const grupos = {};
      datos.forEach(d => {
        if (!grupos[d.carpeta]) grupos[d.carpeta] = [];
        grupos[d.carpeta].push({ nombre: d.nombre, id: d.id });
      });
      this.planillasAgrupadas = Object.keys(grupos).map(carpeta => ({
        carpeta, planillas: grupos[carpeta], abierto: false
      }));
    },
    toggleGrupo(index) {
      this.planillasAgrupadas[index].abierto = !this.planillasAgrupadas[index].abierto;
    }
  },
  mounted() { this.cargarDatos(); }
});
app.mount('#app');
</script>

</body>
</html>
