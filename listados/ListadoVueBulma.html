<!DOCTYPE html>
<html lang="es-ar">
<head>
  <meta charset="UTF-8">
  <title>Planillas por Carpeta - Bulma</title>
  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <!-- Bulma CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css">
</head>
<body class="has-background-light p-5">

<div id="app" class="container">
  <h1 class="title">Planillas</h1>
  
  <div v-for="(grupo, index) in planillasAgrupadas" :key="index" class="box">
    <button 
      @click="toggleGrupo(index)" 
      class="button is-primary is-fullwidth has-text-left"
    >
      {{ grupo.carpeta }}
    </button>
    <div v-show="grupo.abierto" class="mt-3">
      <a 
        v-for="planilla in grupo.planillas" 
        :key="planilla.id"
        :href="'https://docs.google.com/spreadsheets/d/' + planilla.id"
        target="_blank"
        class="box is-clickable mb-2"
        style="padding: 0.5rem;"
      >
        ðŸ“„ {{ planilla.nombre }}
      </a>
    </div>
  </div>
</div>

<script>
const app = Vue.createApp({
  data() {
    return { planillasAgrupadas: [] }
  },
  methods: {
    async cargarDatos() {
      const respuesta = await fetch('https://script.google.com/macros/s/AKfycbzMN6x8dZJXe6CaCje2qZDgQcbjVhtflL-xA6HOqTwqlft746J3TF7FGUt37ttFmhTVSA/exec');
      const datos = await respuesta.json();
      if (!Array.isArray(datos) || datos.length === 0) return;
      const grupos = {};
      datos.forEach(d => {
        if (!grupos[d.carpeta]) grupos[d.carpeta] = [];
        grupos[d.carpeta].push({ nombre: d.nombre, id: d.id });
      });
      this.planillasAgrupadas = Object.keys(grupos).map(carpeta => ({
        carpeta, planillas: grupos[carpeta], abierto: false
      }));
    },
    toggleGrupo(index) {
      this.planillasAgrupadas[index].abierto = !this.planillasAgrupadas[index].abierto;
    }
  },
  mounted() { this.cargarDatos(); }
});
app.mount('#app');
</script>

</body>
</html>
